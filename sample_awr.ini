[dbinfo]
SQL1=dbinfo_sql,dbinfo,[1.1],TRUE
[dbinfo]
select  distinct
    host_name "Host Name",
    db_name   "DB Name",
    instance_name   "Instance",
    version   "Version",
    parallel  "Cluster ?",
    (select to_char(begin_interval_time, 'yyyy-mm-dd hh24:mi:ss') snap_time from    dba_hist_snapshot
     where  (instance_number,snap_id) = (select min(instance_number),min(snap_id) from dba_hist_snapshot
                                          where snap_id between :snap_fr and :snap_to
                                            and instance_number = x.instance_number
                                            and dbid = x.dbid)) "Snap Begin",
    (select to_char(end_interval_time, 'yyyy-mm-dd hh24:mi:ss') snap_time from  dba_hist_snapshot
     where  (instance_number,snap_id) = (select max(instance_number),max(snap_id) from dba_hist_snapshot
                                          where snap_id between :snap_fr and :snap_to
                                            and instance_number = x.instance_number
                                            and dbid = x.dbid)) "Snap End",
    dbid      "DB ID",
    instance_number "Instance#"
from    dba_hist_database_instance x
where instance_number = :inst_no
  and dbid = :dbid
  and parallel=(select decode(value,'TRUE','YES','NO') from dba_hist_parameter
                 where parameter_name='cluster_database' and dbid=:dbid and instance_number=:inst_no and snap_id=:snap_to)
order by instance_number
[osstat]
SQL1=osstat_sql,osstat,[1.1],TRUE
FORMAT1=osstat^[1.3:E.13]^###,##0
FORMAT2=osstat^[1.14:E.17]^##0%
CHART1=osstat,[1.2:E.2/1.3:E.3],ACTIVE,osstat,BUSY_TIME(s)               ,  2,9,LINE,false,dd hh:mm,Date & Time
CHART2=osstat,[1.2:E.2/1.4:E.4],ACTIVE,osstat,IDLE_TIME(s)               , 22,9,LINE,false,dd hh:mm,Date & Time
CHART5=osstat,[1.2:E.2/1.5:E.5],ACTIVE,osstat,USER_TIME(s)               , 82,9,LINE,false,dd hh:mm,Date & Time
CHART4=osstat,[1.2:E.2/1.6:E.6],ACTIVE,osstat,SYS_TIME(s)                , 62,9,LINE,false,dd hh:mm,Date & Time
CHART5=osstat,[1.2:E.2/1.7:E.7],ACTIVE,osstat,IOWAIT_TIME(s)             , 82,9,LINE,false,dd hh:mm,Date & Time
CHART3=osstat,[1.2:E.2/1.8:E.8],ACTIVE,osstat,NICE_TIME(s)               , 42,9,LINE,false,dd hh:mm,Date & Time
CHART6=osstat,[1.2:E.2/1.9:E.9],ACTIVE,osstat,LOAD                       ,102,9,LINE,false,dd hh:mm,Date & Time
CHART7=osstat,[1.2:E.2/1.10:E.10],ACTIVE,osstat,RSRC_MGR_CPU_WAIT_TIME(s),122,9,LINE,false,dd hh:mm,Date & Time
CHART8=osstat,[1.2:E.2/1.11:E.11],ACTIVE,osstat,PHYSICAL_MEMORY_BYTES    ,142,9,LINE,false,dd hh:mm,Date & Time
CHART9=osstat,[1.2:E.2/1.12:E.12],ACTIVE,osstat,NUM_CPUS                 ,162,9,LINE,false,dd hh:mm,Date & Time
CHART10=osstat,[1.2:E.2/1.13:E.13],ACTIVE,osstat,NUM_CPU_SOCKETS         ,182,9,LINE,false,dd hh:mm,Date & Time
CHART11=osstat,[1.2:E.2/1.14:E.17],ACTIVE,osstat,CPU Usage (%)           ,  2,18,LINE,TRUE,dd hh:mm,Date & Time
[osstat]
select /* awrsql */  snap_id,
        to_char(end_interval_time,'yyyy-mm-dd hh24:mi:ss') "Timestamp",
        max(decode(stat_name, 'BUSY_TIME', delta, 0))/100 "BUSY_TIME",
        max(decode(stat_name, 'IDLE_TIME', delta, 0))/100 "IDLE_TIME",
        max(decode(stat_name, 'USER_TIME', delta, 0))/100 "USER_TIME",
        max(decode(stat_name, 'SYS_TIME', delta, 0))/100 "SYS_TIME",
        max(decode(stat_name, 'IOWAIT_TIME', delta, 0))/100 "IOWAIT_TIME",
        max(decode(stat_name, 'NICE_TIME', delta, 0))/100 "NICE_TIME",
        max(decode(stat_name, 'LOAD', delta, 0)) "LOAD",
        max(decode(stat_name, 'RSRC_MGR_CPU_WAIT_TIME', delta, 0))/100 "RSRC_MGR_CPU_WAIT_TIME",
        max(decode(stat_name, 'PHYSICAL_MEMORY_BYTES', value, 0)) "PHYSICAL_MEMORY_BYTES",
        max(decode(stat_name, 'NUM_CPUS', value, 0)) "NUM_CPUS",
        max(decode(stat_name, 'NUM_CPU_SOCKETS', value, 0)) "NUM_CPU_SOCKETS",
        decode((max(decode(stat_name, 'IDLE_TIME', delta, 0))+max(decode(stat_name, 'BUSY_TIME', delta, 0))),0,0,
         (max(decode(stat_name, 'USER_TIME', delta, 0))+max(decode(stat_name, 'NICE_TIME', delta, 0)))
        /(max(decode(stat_name, 'IDLE_TIME', delta, 0))+max(decode(stat_name, 'BUSY_TIME', delta, 0)))) "%usr",
        decode((max(decode(stat_name, 'IDLE_TIME', delta, 0))+max(decode(stat_name, 'BUSY_TIME', delta, 0))),0,0,
         max(decode(stat_name, 'SYS_TIME', delta, 0))
        /(max(decode(stat_name, 'IDLE_TIME', delta, 0))+max(decode(stat_name, 'BUSY_TIME', delta, 0)))) "%sys",
        decode((max(decode(stat_name, 'IDLE_TIME', delta, 0))+max(decode(stat_name, 'BUSY_TIME', delta, 0))),0,0,
         (max(decode(stat_name, 'IOWAIT_TIME', delta, 0)))
        /(max(decode(stat_name, 'IDLE_TIME', delta, 0))+max(decode(stat_name, 'BUSY_TIME', delta, 0)))) "%wio",
        decode((max(decode(stat_name, 'IDLE_TIME', delta, 0))+max(decode(stat_name, 'BUSY_TIME', delta, 0))),0,0,
         max(decode(stat_name, 'IDLE_TIME', delta, 0))
        /(max(decode(stat_name, 'IDLE_TIME', delta, 0))+max(decode(stat_name, 'BUSY_TIME', delta, 0)))) "%idle"
  from (
         select sn.snap_id,
                sn.end_interval_time,
                os.stat_name,
                (nvl(value - lag(value)
                  over ( partition by stat_name order by os.snap_id), 0)) delta,
                os.value value
          from dba_hist_osstat os,
               dba_hist_snapshot sn
         where os.snap_id = sn.snap_id
           and os.instance_number = sn.instance_number
           and os.dbid = sn.dbid
           and sn.snap_id between :snap_fr and :snap_to
           and sn.instance_number = :inst_no
           and sn.dbid = :dbid
       )
where snap_id > :snap_fr
group by snap_id, to_char(end_interval_time,'yyyy-mm-dd hh24:mi:ss')
order by snap_id
